# 🔧 剧本分析功能配置说明

## 问题原因

剧本分析功能提示"分析失败，请检查网络连接"的原因是：**OpenRouter API 密钥未配置**

服务器日志显示：`[ERROR] OpenRouter API Key not configured`

## 解决方案

### 步骤 1: 获取 OpenRouter API 密钥

1. 访问 [OpenRouter 官网](https://openrouter.ai)
2. 注册/登录账号
3. 进入 [API Keys 页面](https://openrouter.ai/keys)
4. 点击 "Create Key" 创建新的 API 密钥
5. 复制生成的密钥（格式类似：`sk-or-v1-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`）

### 步骤 2: 配置 API 密钥

1. 打开项目根目录下的 `.env.local` 文件
2. 找到这一行：
   ```
   OPENROUTER_API_KEY=your_api_key_here
   ```
3. 将 `your_api_key_here` 替换为你刚才复制的真实 API 密钥：
   ```
   OPENROUTER_API_KEY=sk-or-v1-你的真实密钥
   ```
4. 保存文件

### 步骤 3: 重启开发服务器

配置完成后，需要重启服务器才能生效：

1. 在终端中按 `Ctrl + C` 停止当前服务器
2. 重新运行 `npm run dev` 启动服务器
3. 刷新浏览器页面

## 验证配置

配置完成后，尝试使用剧本分析功能：

1. 在首页输入剧本内容
2. 点击"分析剧本"按钮
3. 如果配置正确，应该能看到分析进度并最终得到角色和场景信息

## 其他功能说明

- **其他 API 功能正常**：因为它们可能使用了不同的 API 或有默认配置
- **只有剧本分析需要 OpenRouter**：该功能使用 Google Gemini 或 Claude 等大语言模型进行深度分析

## 费用说明

- OpenRouter 是一个 AI API 聚合平台
- 需要充值才能使用（按使用量计费）
- 不同模型价格不同，建议先充值少量金额测试
- 查看价格：https://openrouter.ai/docs#models

## 可选配置

如果需要使用数据库功能保存历史记录，还需要配置 Supabase：

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

但这不是必需的，不配置也不影响剧本分析功能的使用。

## 常见问题

### Q: 配置后还是提示错误？
A: 请确保：
1. API 密钥格式正确（以 `sk-or-v1-` 开头）
2. 已重启开发服务器
3. OpenRouter 账户有余额

### Q: 如何查看 API 使用情况？
A: 登录 OpenRouter 后台，在 Dashboard 可以查看使用量和余额

### Q: 支持哪些 AI 模型？
A: 当前支持：
- Google Gemini 1.5 Flash（默认，速度快）
- Google Gemini 1.5 Pro（质量高）
- Claude 3.5 Sonnet（平衡）

## 需要帮助？

如果配置过程中遇到问题，请检查：
1. `.env.local` 文件是否在项目根目录
2. API 密钥是否正确复制（没有多余空格）
3. 服务器终端是否有其他错误信息

